
<%= link_to 'Back', '/auctions' %>
<div class="panel panel-primary">
  <div class="panel-heading"><%= @auction_find.title %></div>
  <div class="panel-body">
    <b>Description:</b>  <%= @auction_find.description %><br><br><br><br>
    <b>Number of Bids:</b> <%= @auction_find.bids.count %>
    <h2>Current Price
      <% if @auction_find.bids.empty? %>
        <%= @auction_find.minimum_price %>
      <% else %>
      $<%= @last_bid.price %>
      <% end %>
    </h2>
    <form action="/bids" method="post">
      <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
      <input type="hidden" name="auction_id" value="<%= @auction_find.id %>">
        Bid <input type="number" step="any" class="form-control" name="price" style="width: 150px"><button type="submit" class="btn btn-warning" style="display: inline-block">Bid! </button>
    </form><br><br>
    <% if @user.level > 1 %>
      Bid History <br><br><br>
      <% if @auction_history.empty? %>
      No Bids yet...
        <% else %>
        <% @auction_history.each do |history| %>
        User ID: <%= history.user_id %> bidded $<%=history.price %> on <%= history.created_at %> <br><hr>
        <% end %>
      <% end %>
      <% else %>
      <%end %>

  <div style='width: 800px;'>
    <div id="directions" style='width: 800px; height: 400px;'></div>
  </div>

</div>
<script type="text/javascript">
var directionsDisplay = new google.maps.DirectionsRenderer();
var directionsService = new google.maps.DirectionsService();

function calcRoute() {
  var origin      = new google.maps.LatLng(<%= @results.latitude %>, <%= @results.longitude %>);
  var destination = new google.maps.LatLng(42.850033, -85.6500523);
  var request = {
      origin:      origin,
      destination: destination,
      travelMode:  google.maps.TravelMode.DRIVING
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    }
  });
}

calcRoute();

var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'directions'}}, function(){
  directionsDisplay.setMap(handler.getMap());
});

</script>
<script src="//maps.google.com/maps/api/js?key="AIzaSyBvkzDkwN4uqroOeJitlDoGiRtHnD_7skk" "></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js"></script>